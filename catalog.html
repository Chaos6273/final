<!DOCTYPE html> 
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–ö–∏–Ω–æ–¢—Ä–µ–Ω–¥–û–±—ã–∫–Ω–æ–≤–µ–Ω–Ω—ã–π</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background: radial-gradient(circle at 20% 20%, #0b0017, #020005);
      color: #d9bfff;
    }
    ::selection {
      background: #7f00ff;
      color: white;
    }
    .neon-glow {
      box-shadow: 0 0 10px rgba(143, 0, 255, 0.4), 0 0 25px rgba(143, 0, 255, 0.2);
    }
    .neon-text {
      text-shadow: 0 0 10px rgba(143, 0, 255, 0.6), 0 0 20px rgba(143, 0, 255, 0.3);
    }
  </style>
</head>
<body class="min-h-screen text-purple-100">
  <header class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 p-4 bg-gradient-to-r from-black via-[#1a0033] to-black shadow-lg sticky top-0 z-10 border-b border-purple-900">
    <h1 class="text-3xl font-extrabold text-purple-400 tracking-wide neon-text">
      <a href="index.html" class="hover:underline cursor-pointer">üé¨ –ö–∏–Ω–æ–¢—Ä–µ–Ω–¥–û–±—ã–∫–Ω–æ–≤–µ–Ω–Ω—ã–π</a>
    </h1>

    <div class="flex flex-wrap gap-3 items-center justify-between w-full sm:w-auto">
      <input
        id="searchInput"
        type="text"
        placeholder="üîç –ü–æ–∏—Å–∫ —Ñ–∏–ª—å–º–æ–≤..."
        class="bg-black/70 border border-purple-900 text-purple-300 placeholder-purple-600 px-3 py-2 rounded-lg w-full sm:w-60 focus:outline-none focus:ring-2 focus:ring-purple-700 transition"
      />

      <select id="genreSelect" class="bg-black/70 border border-purple-900 text-purple-300 px-3 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-700 transition">
        <option value="comedy">–ö–æ–º–µ–¥–∏–∏</option>
        <option value="drama">–î—Ä–∞–º—ã</option>
        <option value="animation">–ú—É–ª—å—Ç—Ñ–∏–ª—å–º—ã</option>
        <option value="horror">–£–∂–∞—Å—ã</option>
      </select>

      <button id="favoritesToggle" class="bg-purple-800 hover:bg-purple-900 neon-glow px-4 py-2 rounded-lg font-semibold text-white transition">
        –ü–æ–∫–∞–∑–∞—Ç—å –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
      </button>
    </div>
  </header>

  <main class="p-6">
    <div id="moviesContainer" class="grid gap-6 grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4"></div>
    <div class="flex justify-center mt-6">
      <button id="loadMoreBtn" class="bg-purple-800 hover:bg-purple-900 neon-glow px-6 py-2 rounded-lg hidden text-white transition">
        –ü–æ–∫–∞–∑–∞—Ç—å –±–æ–ª—å—à–µ
      </button>
    </div>
  </main>

  <!-- –ú–æ–¥–∞–ª–∫–∞ -->
  <div
    id="movieModal"
    class="fixed inset-0 bg-black bg-opacity-0 opacity-0 scale-95 pointer-events-none transition-all duration-300 flex items-center justify-center z-20"
  >
    <div class="bg-black border border-purple-900 rounded-xl p-6 max-w-md w-full relative transform transition-all duration-300 scale-95 opacity-0 shadow-2xl neon-glow">
      <button id="closeModal" class="absolute top-3 right-3 text-purple-400 hover:text-purple-200 text-xl">‚úñ</button>
      <img id="modalPoster" class="rounded-lg mb-4 w-full shadow-md shadow-purple-900/50" src="" alt="–ü–æ—Å—Ç–µ—Ä —Ñ–∏–ª—å–º–∞" />
      <h2 id="modalTitle" class="text-2xl font-bold mb-2 text-purple-300 neon-text"></h2>
      <p id="modalYear" class="text-purple-500 text-sm mb-3"></p>
      <p id="modalDescription" class="text-purple-200 mb-4"></p>
      <button id="modalFavoriteBtn" class="bg-purple-800 hover:bg-purple-900 neon-glow w-full py-2 rounded-lg transition font-semibold">
        –î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
      </button>
    </div>
  </div>

  <script>
    const container = document.getElementById("moviesContainer");
    const genreSelect = document.getElementById("genreSelect");
    const favoritesToggle = document.getElementById("favoritesToggle");
    const loadMoreBtn = document.getElementById("loadMoreBtn");
    const searchInput = document.getElementById("searchInput");

    const modal = document.getElementById("movieModal");
    const closeModal = document.getElementById("closeModal");
    const modalPoster = document.getElementById("modalPoster");
    const modalTitle = document.getElementById("modalTitle");
    const modalYear = document.getElementById("modalYear");
    const modalDescription = document.getElementById("modalDescription");
    const modalFavoriteBtn = document.getElementById("modalFavoriteBtn");

    let movies = [];
    let favorites = JSON.parse(localStorage.getItem("favorites")) || [];
    let showingFavorites = false;
    let currentGenre = "comedy";
    let currentIndex = 0;
    const perPage = 12;

    async function loadMovies(genre) {
      try {
        const res = await fetch(`https://api.sampleapis.com/movies/${genre}`);
        movies = await res.json();
        currentIndex = 0;
        renderMovies();
      } catch {
        container.innerHTML = '<p class="text-purple-400">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∏–ª—å–º–æ–≤</p>';
      }
    }

    async function searchMovies(query) {
      if (!query.trim()) {
        loadMovies(currentGenre);
        return;
      }

      try {
        const res = await fetch(`https://api.sampleapis.com/movies/${currentGenre}`);
        const data = await res.json();
        movies = data.filter(movie =>
          movie.title.toLowerCase().includes(query.toLowerCase())
        );
        renderMovies();
      } catch {
        container.innerHTML = '<p class="text-purple-400">–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ —Ñ–∏–ª—å–º–æ–≤</p>';
      }
    }

    function renderMovies() {
      container.innerHTML = "";

      let list = showingFavorites
        ? favorites.filter(f => f.genre === currentGenre)
        : movies;

      const display = list.slice(0, currentIndex + perPage);
      display.forEach((movie) => {
        const card = document.createElement("div");
        card.className =
          "bg-black border border-purple-900 rounded-xl p-3 shadow-lg hover:shadow-purple-900/60 cursor-pointer transition-transform hover:scale-105";
        card.innerHTML = `
          <img src="${movie.posterURL || "https://via.placeholder.com/300x450?text=–ù–µ—Ç+–ø–æ—Å—Ç–µ—Ä–∞"}"
               class="rounded-lg mb-3 w-full h-64 object-cover shadow-md shadow-purple-900/50" alt="–ü–æ—Å—Ç–µ—Ä">
          <h3 class="text-lg font-semibold mb-1 text-purple-300">${movie.title}</h3>
          <p class="text-sm text-purple-600">${movie.year || "‚Äî"}</p>
        `;
        card.addEventListener("click", () => openModal(movie));
        container.appendChild(card);
      });

      if (currentIndex + perPage < list.length) {
        loadMoreBtn.classList.remove("hidden");
      } else {
        loadMoreBtn.classList.add("hidden");
      }
    }

    function openModal(movie) {
      modalPoster.src =
        movie.posterURL || "https://via.placeholder.com/300x450?text=–ù–µ—Ç+–ø–æ—Å—Ç–µ—Ä–∞";
      modalTitle.textContent = movie.title;
      modalYear.textContent = movie.year ? `–ì–æ–¥: ${movie.year}` : "";
      modalDescription.textContent =
        movie.description || "–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.";
      modalFavoriteBtn.textContent = favorites.find((f) => f.title === movie.title)
        ? "–£–¥–∞–ª–∏—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ"
        : "–î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ";
      modalFavoriteBtn.onclick = () => toggleFavorite(movie);

      modal.classList.remove("pointer-events-none");
      modal.classList.add("bg-opacity-80");
      modal.classList.replace("opacity-0", "opacity-100");
      modal.classList.replace("scale-95", "scale-100");
      const modalBox = modal.querySelector("div");
      modalBox.classList.replace("scale-95", "scale-100");
      modalBox.classList.replace("opacity-0", "opacity-100");
    }

    function closeModalAnimated() {
      modal.classList.replace("opacity-100", "opacity-0");
      modal.classList.replace("bg-opacity-80", "bg-opacity-0");
      const modalBox = modal.querySelector("div");
      modalBox.classList.replace("opacity-100", "opacity-0");
      modalBox.classList.replace("scale-100", "scale-95");
      setTimeout(() => {
        modal.classList.add("pointer-events-none");
      }, 300);
    }

    function toggleFavorite(movie) {
      const index = favorites.findIndex((f) => f.title === movie.title);
      if (index > -1) {
        favorites.splice(index, 1);
      } else {
        const movieWithGenre = { ...movie, genre: currentGenre };
        favorites.push(movieWithGenre);
      }
      localStorage.setItem("favorites", JSON.stringify(favorites));
      modalFavoriteBtn.textContent =
        index > -1 ? "–î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ" : "–£–¥–∞–ª–∏—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ";
      if (showingFavorites) renderMovies();
    }

    closeModal.addEventListener("click", closeModalAnimated);

    favoritesToggle.addEventListener("click", () => {
      showingFavorites = !showingFavorites;
      favoritesToggle.textContent = showingFavorites
        ? "–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∫–∞—Ç–∞–ª–æ–≥—É"
        : "–ü–æ–∫–∞–∑–∞—Ç—å –∏–∑–±—Ä–∞–Ω–Ω–æ–µ";
      renderMovies();
    });

    genreSelect.addEventListener("change", (e) => {
      currentGenre = e.target.value;
      localStorage.setItem("selectedGenre", currentGenre);
      showingFavorites = false;
      favoritesToggle.textContent = "–ü–æ–∫–∞–∑–∞—Ç—å –∏–∑–±—Ä–∞–Ω–Ω–æ–µ";
      loadMovies(currentGenre);
    });

    loadMoreBtn.addEventListener("click", () => {
      currentIndex += perPage;
      renderMovies();
    });

    searchInput.addEventListener("input", (e) => {
      searchMovies(e.target.value);
    });

    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–π –∂–∞–Ω—Ä, –µ—Å–ª–∏ –µ—Å—Ç—å
    const savedGenre = localStorage.getItem("selectedGenre");
    if (savedGenre && genreSelect.querySelector(`option[value="${savedGenre}"]`)) {
      currentGenre = savedGenre;
      genreSelect.value = savedGenre;
    }

    loadMovies(currentGenre);
  </script>
</body>
</html>
