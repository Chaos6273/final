<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–ö–∏–Ω–æ–¢—Ä–µ–Ω–¥–û—Ç–∫—Ä—ã—Ç–∏–µ</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body {
      background: radial-gradient(circle at top, #1a1a1a, #0b0b0f);
      color: #e5e5e5;
    }

    ::selection {
      background: #e50914;
      color: white;
    }
  </style>
</head>

<body class="min-h-screen">

  <!-- HEADER -->
  <header class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 p-4 bg-black/80 backdrop-blur-md sticky top-0 z-10 border-b border-white/10">
    <h1 class="text-2xl font-bold tracking-wide text-white">
      <a href="index.html">üé¨ –ö–∏–Ω–æ–¢—Ä–µ–Ω–¥–û—Ç–∫—Ä—ã—Ç–∏–µ</a>
    </h1>

    <div class="flex flex-wrap gap-3 items-center w-full sm:w-auto">
      <input
        id="searchInput"
        type="text"
        placeholder="–ü–æ–∏—Å–∫ —Ñ–∏–ª—å–º–æ–≤..."
        class="bg-[#141414] border border-white/10 text-white placeholder-gray-500 px-3 py-2 rounded-md w-full sm:w-60 focus:outline-none focus:ring-2 focus:ring-red-600 transition"
      />

      <select id="genreSelect"
        class="bg-[#141414] border border-white/10 text-white px-3 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-red-600 transition">
        <option value="all">–í—Å–µ</option>
<option value="Drama">–î—Ä–∞–º–∞</option>
<option value="Comedy">–ö–æ–º–µ–¥–∏—è</option>
<option value="Crime">–ö—Ä–∏–º–∏–Ω–∞–ª</option>
<option value="Thriller">–¢—Ä–∏–ª–ª–µ—Ä</option>
<option value="Fantasy">–§—ç–Ω—Ç–µ–∑–∏</option>
<option value="Horror">–£–∂–∞—Å—ã</option>
      </select>

      <button id="favoritesToggle"
        class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded-md font-semibold transition">
        –ò–∑–±—Ä–∞–Ω–Ω–æ–µ
      </button>
    </div>
  </header>

  <!-- MAIN -->
  <main class="p-6">
    <div id="moviesContainer"
      class="grid gap-6 grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4">
    </div>

    <div class="flex justify-center mt-8">
      <button id="loadMoreBtn"
        class="bg-red-600 hover:bg-red-700 px-6 py-2 rounded-md hidden font-semibold transition">
        –ü–æ–∫–∞–∑–∞—Ç—å –±–æ–ª—å—à–µ
      </button>
    </div>
  </main>

  <!-- MODAL -->
  <div id="movieModal"
    class="fixed inset-0 bg-black/80 opacity-0 scale-95 pointer-events-none transition-all duration-300 flex items-center justify-center z-20 backdrop-blur-md">

    <div
      class="bg-[#141414] rounded-xl p-6 max-w-3xl w-full relative transform transition-all duration-300 scale-95 opacity-0 shadow-2xl">

      <button id="closeModal"
        class="absolute top-3 right-3 text-gray-400 hover:text-white text-xl">‚úñ</button>

      <div class="flex flex-col md:flex-row gap-6">
        <img id="modalPoster"
          class="rounded-lg w-full md:w-64 h-96 object-cover shadow-lg"
          src="" alt="–ü–æ—Å—Ç–µ—Ä">

        <div class="flex flex-col justify-between">
          <div>
            <h2 id="modalTitle" class="text-3xl font-bold mb-2"></h2>
            <p id="modalYear" class="text-gray-400 mb-4"></p>
            <p id="modalDescription" class="text-gray-300"></p>
          </div>

          <div class="mt-6 flex gap-3">
            <button id="modalFavoriteBtn"
              class="bg-[#1f1f1f] hover:bg-[#2a2a2a] px-4 py-2 rounded-md transition">
              –í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- SCRIPT -->
  <script>
    const container = document.getElementById("moviesContainer");
    const genreSelect = document.getElementById("genreSelect");
    const favoritesToggle = document.getElementById("favoritesToggle");
    const loadMoreBtn = document.getElementById("loadMoreBtn");
    const searchInput = document.getElementById("searchInput");

    const modal = document.getElementById("movieModal");
    const closeModal = document.getElementById("closeModal");
    const modalPoster = document.getElementById("modalPoster");
    const modalTitle = document.getElementById("modalTitle");
    const modalYear = document.getElementById("modalYear");
    const modalDescription = document.getElementById("modalDescription");
    const modalFavoriteBtn = document.getElementById("modalFavoriteBtn");
    
    let movies = [];
    let favorites = JSON.parse(localStorage.getItem("favorites")) || [];
    let showingFavorites = false;
    let currentGenre = "all";
    let searchQuery = "";
    let currentIndex = 0;
    const perPage = 12;

    async function loadMovies() {
        const res = await fetch("https://api.tvmaze.com/shows");
        movies = await res.json();
        currentIndex = 0;
        renderMovies();
}

    function renderMovies() {
        
  container.innerHTML = "";

  const baseList = showingFavorites ? favorites : movies;

const source =
  currentGenre === "all"
    ? baseList
    : baseList.filter(show =>
        show.genres?.includes(currentGenre)
      );
const finalList = searchQuery
  ? source.filter(show =>
      show.name.toLowerCase().includes(searchQuery)
    )
  : source;
  if (!source.length) {
    container.innerHTML = `
      <p class="text-gray-400 col-span-full text-center mt-10">
        ${showingFavorites ? "–ò–∑–±—Ä–∞–Ω–Ω–æ–µ –ø—É—Å—Ç–æ üò¢" : "–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ"}
      </p>
    `;
    loadMoreBtn.classList.add("hidden");
    return;
  }

  const display = finalList.slice(0, currentIndex + perPage);

  display.forEach(show => {
    const poster =
      show.image?.medium ||
      "https://via.placeholder.com/300x450?text=No+Image";

    const card = document.createElement("div");
    card.className =
      "bg-[#141414] rounded-lg overflow-hidden cursor-pointer transition-transform hover:scale-105";

    card.innerHTML = `
      <img src="${poster}" class="w-full h-72 object-cover">
      <div class="p-3">
        <h3 class="font-semibold text-white">${show.name}</h3>
        <p class="text-gray-400 text-sm">
          ‚≠ê ${show.rating?.average ?? "‚Äî"}
        </p>
      </div>
    `;

    card.onclick = () => openModal(show);
    container.appendChild(card);
  });

  loadMoreBtn.classList.toggle(
    "hidden",
    currentIndex + perPage >= finalList.length
  );
}
    function renderFilteredMovies(list) {
        container.innerHTML = "";
        currentIndex = 0;
        list.slice(0, perPage).forEach(movie => {
            const card = document.createElement("div");
            card.className = "bg-[#141414] rounded-lg overflow-hidden cursor-pointer hover:scale-105 transition";

    card.innerHTML = `
    <div class="relative">
        <img src="https://via.placeholder.com/300x450?text=No+Poster"
        class="w-full h-72 object-cover">
        <div class="p-3">
            <h3 class="font-semibold">${movie.title}</h3>
            <p class="text-gray-400 text-sm">${movie.release_date}</p>
        </div>
    </div>`;
    card.onclick = () => openModal(movie);
    container.appendChild(card);});
    loadMoreBtn.classList.add("hidden");
}
    function toggleFavorite(show) {
  const index = favorites.findIndex(f => f.id === show.id);

  if (index > -1) {
    favorites.splice(index, 1);
  } else {
    favorites.push(show);
  }

  localStorage.setItem("favorites", JSON.stringify(favorites));

  modalFavoriteBtn.textContent =
    index > -1 ? "–í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ" : "–£–¥–∞–ª–∏—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ";

  if (showingFavorites) renderMovies();
}

    function openModal(show) {
  modalPoster.src =
    show.image?.original ||
    "https://via.placeholder.com/300x450?text=No+Image";

  modalTitle.textContent = show.name;
  modalYear.textContent = show.premiered
    ? `–ü—Ä–µ–º—å–µ—Ä–∞: ${show.premiered}`
    : "";

  modalDescription.innerHTML =
    show.summary
      ? show.summary.replace(/<[^>]+>/g, "")
      : "–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.";

  modal.classList.remove("pointer-events-none", "opacity-0", "scale-95");
  modal.classList.add("opacity-100", "scale-100");

  const box = modal.querySelector("div");
  box.classList.remove("opacity-0", "scale-95");
  box.classList.add("opacity-100", "scale-100");
  modalFavoriteBtn.textContent =
  favorites.some(f => f.id === show.id)
    ? "–£–¥–∞–ª–∏—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ"
    : "–í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ";

modalFavoriteBtn.onclick = () => toggleFavorite(show);
}

    function closeModalAnimated() {
  modal.classList.remove("opacity-100", "scale-100");
  modal.classList.add("opacity-0", "scale-95");

  setTimeout(() => {
    modal.classList.add("pointer-events-none");
  }, 300);
}

    closeModal.onclick = closeModalAnimated;

    favoritesToggle.onclick = () => {
  showingFavorites = !showingFavorites;
  favoritesToggle.textContent =
    showingFavorites ? "–ö–∞—Ç–∞–ª–æ–≥" : "–ò–∑–±—Ä–∞–Ω–Ω–æ–µ";
  currentIndex = 0;
  renderMovies();
};

    genreSelect.onchange = e => {
  currentGenre = e.target.value;
  currentIndex = 0;
  renderMovies();
};

    loadMoreBtn.onclick = () => {
      currentIndex += perPage;
      renderMovies();
    };

    searchInput.oninput = e => {
  searchQuery = e.target.value.toLowerCase();
  currentIndex = 0;
  renderMovies();
};
    loadMovies(currentGenre);
  </script>

</body>
</html>
